# ğŸ” EC2 éƒ¨ç½²ååº”ç”¨ç¨‹åºæ£€æŸ¥æŒ‡å—

## ğŸ“‹ æ£€æŸ¥æ¸…å•æ¦‚è§ˆ

éƒ¨ç½²å®Œæˆåï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºè¿›è¡Œæ£€æŸ¥ï¼š

```
âœ… 1. åŸºç¡€è¿æ¥æ£€æŸ¥ (30ç§’)
âœ… 2. æœåŠ¡çŠ¶æ€æ£€æŸ¥ (1åˆ†é’Ÿ)  
âœ… 3. åº”ç”¨åŠŸèƒ½æ£€æŸ¥ (2åˆ†é’Ÿ)
âœ… 4. æ€§èƒ½å’Œç¨³å®šæ€§æ£€æŸ¥ (5åˆ†é’Ÿ)
âœ… 5. æ—¥å¿—å’Œç›‘æ§æ£€æŸ¥ (3åˆ†é’Ÿ)
```

---

## ğŸš€ ç¬¬1æ­¥ï¼šåŸºç¡€è¿æ¥æ£€æŸ¥

### 1.1 æ£€æŸ¥ EC2 å®ä¾‹çŠ¶æ€
```bash
# åœ¨ AWS æ§åˆ¶å°æ£€æŸ¥ï¼š
# EC2 > å®ä¾‹ > é€‰æ‹©ä½ çš„å®ä¾‹
# å®ä¾‹çŠ¶æ€ï¼šrunning âœ…
# çŠ¶æ€æ£€æŸ¥ï¼š2/2 checks passed âœ…
```

### 1.2 SSH è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•èƒ½å¦è¿æ¥åˆ°æœåŠ¡å™¨
ssh -i your-key.pem ubuntu@your-ec2-ip

# æˆåŠŸè¿æ¥åä¼šçœ‹åˆ°ï¼š
# Welcome to Ubuntu 20.04.x LTS (GNU/Linux ...)
# ubuntu@ip-xxx-xxx-xxx-xxx:~$
```

### 1.3 ç½‘ç»œç«¯å£æ£€æŸ¥
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥ç«¯å£ 8000 æ˜¯å¦å¼€æ”¾
netstat -tuln | grep 8000

# æœŸå¾…ç»“æœï¼š
# tcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN

# å¦‚æœæ²¡æœ‰ç»“æœï¼Œè¯´æ˜åº”ç”¨ç¨‹åºæ²¡æœ‰å¯åŠ¨
```

---

## âš™ï¸ ç¬¬2æ­¥ï¼šæœåŠ¡çŠ¶æ€æ£€æŸ¥

### 2.1 æ£€æŸ¥ systemd æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹åº”ç”¨ç¨‹åºæœåŠ¡çŠ¶æ€
sudo systemctl status my-python-app

# âœ… æ­£å¸¸çŠ¶æ€åº”è¯¥æ˜¾ç¤ºï¼š
# â— my-python-app.service - CodePipeline Demo Python Application
#    Loaded: loaded (/etc/systemd/system/my-python-app.service; enabled; vendor preset: enabled)
#    Active: active (running) since Wed 2025-01-15 10:30:00 UTC; 15min ago
#    Main PID: 12345 (python3)
#    Memory: 25.2M
#    CGroup: /system.slice/my-python-app.service
#            â””â”€12345 /usr/bin/python3 /opt/my-python-app/sampl-app.py
```

**çŠ¶æ€è¯´æ˜ï¼š**
- `Active: active (running)` âœ… = æœåŠ¡æ­£åœ¨è¿è¡Œ
- `Active: inactive (dead)` âŒ = æœåŠ¡å·²åœæ­¢
- `Active: failed` âŒ = æœåŠ¡å¯åŠ¨å¤±è´¥

### 2.2 æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜åœ¨
```bash
# æŸ¥æ‰¾ Python åº”ç”¨ç¨‹åºè¿›ç¨‹
ps aux | grep sampl-app.py

# âœ… æ­£å¸¸ç»“æœï¼š
# ubuntu   12345  0.1  2.3  45678  12345 ?  S  10:30  0:05 python3 /opt/my-python-app/sampl-app.py

# âŒ å¦‚æœæ²¡æœ‰ç»“æœï¼Œè¯´æ˜è¿›ç¨‹ä¸å­˜åœ¨
```

### 2.3 æ£€æŸ¥æœåŠ¡è‡ªå¯åŠ¨è®¾ç½®
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦è®¾ç½®ä¸ºå¼€æœºè‡ªå¯
sudo systemctl is-enabled my-python-app

# âœ… æœŸå¾…ç»“æœï¼šenabled
# âŒ å¦‚æœæ˜¾ç¤º disabledï¼Œéœ€è¦å¯ç”¨è‡ªå¯åŠ¨
```

---

## ğŸŒ ç¬¬3æ­¥ï¼šåº”ç”¨åŠŸèƒ½æ£€æŸ¥

### 3.1 æœ¬åœ°è®¿é—®æµ‹è¯•ï¼ˆåœ¨ EC2 æœåŠ¡å™¨ä¸Šï¼‰
```bash
# æµ‹è¯•ä¸»é¡µé¢
curl http://localhost:8000/

# âœ… æœŸå¾…ç»“æœï¼ˆJSON æ ¼å¼ï¼‰ï¼š
{
  "message": "Hello World from CodePipeline!",
  "timestamp": "2025-01-15T10:45:00.000Z",
  "version": "1.0.2",
  "environment": "production",
  "hostname": "ip-172-31-32-123",
  "status": "success",
  "deployment_info": {
    "deployed_at": "2025-01-15 10:29:45",
    "python_version": "3.9",
    "platform": "posix",
    "build_time": "2025-01-15T10:28:30Z",
    "commit": "abc123def456"
  }
}
```

### 3.2 å¥åº·æ£€æŸ¥æµ‹è¯•
```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥æ¥å£
curl http://localhost:8000/health

# âœ… æœŸå¾…ç»“æœï¼š
{
  "status": "healthy",
  "timestamp": "2025-01-15T10:45:00.000Z",
  "uptime": 900.5
}
```

### 3.3 å¤–ç½‘è®¿é—®æµ‹è¯•ï¼ˆä»ä½ çš„ç”µè„‘ï¼‰
```bash
# ä»æœ¬åœ°ç”µè„‘æµ‹è¯•ï¼ˆæ›¿æ¢ä¸ºä½ çš„ EC2 å…¬ç½‘ IPï¼‰
curl http://your-ec2-public-ip:8000/

# æˆ–è€…åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š
# http://your-ec2-public-ip:8000/
```

**å¦‚æœå¤–ç½‘è®¿é—®å¤±è´¥ï¼Œæ£€æŸ¥ï¼š**
```bash
# 1. AWS å®‰å…¨ç»„è®¾ç½®
# EC2 æ§åˆ¶å° > å®‰å…¨ç»„ > å…¥ç«™è§„åˆ™
# ç¡®ä¿æœ‰ï¼šç±»å‹=è‡ªå®šä¹‰TCPï¼Œç«¯å£=8000ï¼Œæº=0.0.0.0/0

# 2. æœåŠ¡å™¨é˜²ç«å¢™
sudo ufw status
# å¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œæ·»åŠ è§„åˆ™ï¼š
sudo ufw allow 8000
```

### 3.4 é”™è¯¯å¤„ç†æµ‹è¯•
```bash
# æµ‹è¯•ä¸å­˜åœ¨çš„é¡µé¢
curl http://localhost:8000/nonexistent

# âœ… æœŸå¾…ç»“æœï¼ˆ404 é”™è¯¯ï¼‰ï¼š
{
  "error": "Not Found",
  "message": "Path /nonexistent not found",
  "available_endpoints": ["/", "/health"]
}
```

---

## ğŸ“Š ç¬¬4æ­¥ï¼šæ€§èƒ½å’Œç¨³å®šæ€§æ£€æŸ¥

### 4.1 å“åº”æ—¶é—´æµ‹è¯•
```bash
# æµ‹è¯•å“åº”æ—¶é—´
time curl -s http://localhost:8000/ > /dev/null

# âœ… æ­£å¸¸å“åº”æ—¶é—´åº”è¯¥åœ¨ 0.1-1.0 ç§’å†…
# real    0m0.234s
# user    0m0.012s
# sys     0m0.008s
```

### 4.2 è¿ç»­è¯·æ±‚æµ‹è¯•
```bash
# è¿ç»­å‘é€ 10 ä¸ªè¯·æ±‚ï¼Œæ£€æŸ¥ç¨³å®šæ€§
for i in {1..10}; do
  echo "è¯·æ±‚ $i:"
  curl -s http://localhost:8000/ | grep -o '"status":"[^"]*"'
  sleep 1
done

# âœ… æ¯æ¬¡éƒ½åº”è¯¥è¿”å›ï¼š
# "status":"success"
```

### 4.3 å¹¶å‘æµ‹è¯•ï¼ˆå¯é€‰ï¼‰
```bash
# å¦‚æœå®‰è£…äº† Apache Bench
sudo apt install apache2-utils

# è¿è¡Œç®€å•çš„å¹¶å‘æµ‹è¯•
ab -n 50 -c 5 http://localhost:8000/

# æŸ¥çœ‹å…³é”®æŒ‡æ ‡ï¼š
# - Complete requests: 50 âœ…
# - Failed requests: 0 âœ…
# - Requests per second: > 10 âœ…
```

### 4.4 å†…å­˜ä½¿ç”¨æ£€æŸ¥
```bash
# æ£€æŸ¥åº”ç”¨ç¨‹åºå†…å­˜ä½¿ç”¨
ps -o pid,ppid,cmd,%mem,%cpu --sort=-%mem | grep sampl-app.py

# âœ… å†…å­˜ä½¿ç”¨åº”è¯¥ < 5%ï¼ˆåœ¨ 1GB å†…å­˜çš„æœåŠ¡å™¨ä¸Šï¼‰
```

---

## ğŸ“ ç¬¬5æ­¥ï¼šæ—¥å¿—å’Œç›‘æ§æ£€æŸ¥

### 5.1 ç³»ç»Ÿæ—¥å¿—æ£€æŸ¥
```bash
# æŸ¥çœ‹æœ€è¿‘çš„ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u my-python-app -n 20

# âœ… æ­£å¸¸æ—¥å¿—ç¤ºä¾‹ï¼š
# Jan 15 10:30:00 ip-xxx systemd[1]: Started CodePipeline Demo Python Application.
# Jan 15 10:30:00 ip-xxx python3[12345]: [2025-01-15T10:30:00.000Z] æœåŠ¡å™¨å¼€å§‹è¿è¡Œ
# Jan 15 10:30:01 ip-xxx python3[12345]: [2025-01-15T10:30:01.000Z] 127.0.0.1 - - "GET / HTTP/1.1" 200 -

# âŒ é”™è¯¯æ—¥å¿—ç¤ºä¾‹ï¼š
# Jan 15 10:30:00 ip-xxx python3[12345]: Traceback (most recent call last):
# Jan 15 10:30:00 ip-xxx python3[12345]: FileNotFoundError: [Errno 2] No such file or directory
```

### 5.2 åº”ç”¨ç¨‹åºæ—¥å¿—æ£€æŸ¥
```bash
# æŸ¥çœ‹åº”ç”¨ç¨‹åºæ—¥å¿—æ–‡ä»¶
tail -20 /var/log/my-python-app/app.log

# âœ… æ­£å¸¸æ—¥å¿—å†…å®¹ï¼š
# [2025-01-15T10:30:00.000Z] æœåŠ¡å™¨å¼€å§‹è¿è¡Œ
# [2025-01-15T10:30:01.000Z] GET / 200
# [2025-01-15T10:30:02.000Z] GET /health 200

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
tail -20 /var/log/my-python-app/error.log

# âœ… å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œæ–‡ä»¶å¯èƒ½ä¸ºç©ºæˆ–ä¸å­˜åœ¨
```

### 5.3 å®æ—¶æ—¥å¿—ç›‘æ§
```bash
# å®æ—¶ç›‘æ§ç³»ç»Ÿæ—¥å¿—
sudo journalctl -u my-python-app -f

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯çª—å£æµ‹è¯•è®¿é—®ï¼š
curl http://localhost:8000/

# åº”è¯¥èƒ½çœ‹åˆ°å®æ—¶çš„è®¿é—®æ—¥å¿—
```

---

## ğŸš¨ å¸¸è§é—®é¢˜å¿«é€Ÿè¯Šæ–­

### é—®é¢˜1ï¼šæ— æ³•è®¿é—®åº”ç”¨ç¨‹åº
```bash
# ç—‡çŠ¶ï¼šcurl: (7) Failed to connect to localhost port 8000: Connection refused

# è¯Šæ–­æ­¥éª¤ï¼š
echo "=== è¯Šæ–­å¼€å§‹ ==="

# 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€
echo "1. æœåŠ¡çŠ¶æ€ï¼š"
sudo systemctl is-active my-python-app

# 2. æ£€æŸ¥ç«¯å£
echo "2. ç«¯å£çŠ¶æ€ï¼š"
netstat -tuln | grep 8000

# 3. æ£€æŸ¥è¿›ç¨‹
echo "3. è¿›ç¨‹çŠ¶æ€ï¼š"
ps aux | grep sampl-app.py | grep -v grep

echo "=== è¯Šæ–­ç»“æŸ ==="
```

### é—®é¢˜2ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šsystemctl status æ˜¾ç¤º failed

# å¿«é€Ÿä¿®å¤è„šæœ¬ï¼š
echo "=== ä¿®å¤å¼€å§‹ ==="

# 1. åœæ­¢æœåŠ¡
sudo systemctl stop my-python-app

# 2. æ£€æŸ¥æ–‡ä»¶æƒé™
sudo chown ubuntu:ubuntu /opt/my-python-app/sampl-app.py
sudo chmod +x /opt/my-python-app/sampl-app.py

# 3. æ‰‹åŠ¨æµ‹è¯•
echo "æ‰‹åŠ¨æµ‹è¯•åº”ç”¨ç¨‹åºï¼š"
cd /opt/my-python-app
timeout 5s python3 sampl-app.py || echo "åº”ç”¨ç¨‹åºå¯åŠ¨å¤±è´¥"

# 4. é‡å¯æœåŠ¡
sudo systemctl start my-python-app
sudo systemctl status my-python-app

echo "=== ä¿®å¤ç»“æŸ ==="
```

### é—®é¢˜3ï¼šå¤–ç½‘æ— æ³•è®¿é—®
```bash
# ç—‡çŠ¶ï¼šæœ¬åœ°å¯ä»¥è®¿é—®ï¼Œå¤–ç½‘ä¸è¡Œ

# æ£€æŸ¥ç½‘ç»œé…ç½®ï¼š
echo "=== ç½‘ç»œè¯Šæ–­ ==="

# 1. æ£€æŸ¥é˜²ç«å¢™
echo "1. é˜²ç«å¢™çŠ¶æ€ï¼š"
sudo ufw status

# 2. æ£€æŸ¥ç›‘å¬åœ°å€
echo "2. ç›‘å¬åœ°å€ï¼š"
netstat -tuln | grep 8000

# 3. æµ‹è¯•æœ¬åœ°è®¿é—®
echo "3. æœ¬åœ°è®¿é—®æµ‹è¯•ï¼š"
curl -s -o /dev/null -w "%{http_code}" http://localhost:8000/

echo "=== è¯·æ£€æŸ¥ AWS å®‰å…¨ç»„è®¾ç½® ==="
```

---

## ğŸ“‹ å®Œæ•´æ£€æŸ¥è„šæœ¬

åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–æ£€æŸ¥è„šæœ¬ï¼š

```bash
# åˆ›å»ºæ£€æŸ¥è„šæœ¬
cat << 'EOF' > /home/ubuntu/check_app.sh
#!/bin/bash

echo "ğŸ” å¼€å§‹æ£€æŸ¥åº”ç”¨ç¨‹åºçŠ¶æ€..."
echo "=================================="

# 1. æœåŠ¡çŠ¶æ€æ£€æŸ¥
echo "1ï¸âƒ£ æœåŠ¡çŠ¶æ€æ£€æŸ¥ï¼š"
if systemctl is-active --quiet my-python-app; then
    echo "   âœ… æœåŠ¡æ­£åœ¨è¿è¡Œ"
else
    echo "   âŒ æœåŠ¡æœªè¿è¡Œ"
    exit 1
fi

# 2. ç«¯å£æ£€æŸ¥
echo "2ï¸âƒ£ ç«¯å£æ£€æŸ¥ï¼š"
if netstat -tuln | grep -q ":8000"; then
    echo "   âœ… ç«¯å£ 8000 æ­£åœ¨ç›‘å¬"
else
    echo "   âŒ ç«¯å£ 8000 æœªå¼€æ”¾"
    exit 1
fi

# 3. HTTP å“åº”æ£€æŸ¥
echo "3ï¸âƒ£ HTTP å“åº”æ£€æŸ¥ï¼š"
HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" http://localhost:8000/)
if [ "$HTTP_CODE" = "200" ]; then
    echo "   âœ… HTTP å“åº”æ­£å¸¸ (çŠ¶æ€ç : $HTTP_CODE)"
else
    echo "   âŒ HTTP å“åº”å¼‚å¸¸ (çŠ¶æ€ç : $HTTP_CODE)"
    exit 1
fi

# 4. å¥åº·æ£€æŸ¥
echo "4ï¸âƒ£ å¥åº·æ£€æŸ¥ï¼š"
HEALTH_STATUS=$(curl -s http://localhost:8000/health | grep -o '"status":"[^"]*"' | cut -d'"' -f4)
if [ "$HEALTH_STATUS" = "healthy" ]; then
    echo "   âœ… å¥åº·æ£€æŸ¥é€šè¿‡"
else
    echo "   âŒ å¥åº·æ£€æŸ¥å¤±è´¥"
    exit 1
fi

# 5. å†…å­˜ä½¿ç”¨æ£€æŸ¥
echo "5ï¸âƒ£ èµ„æºä½¿ç”¨æ£€æŸ¥ï¼š"
MEMORY_USAGE=$(ps -o %mem --no-headers -C python3 | head -1 | xargs)
echo "   ğŸ“Š å†…å­˜ä½¿ç”¨: ${MEMORY_USAGE}%"

# 6. è¿è¡Œæ—¶é—´æ£€æŸ¥
echo "6ï¸âƒ£ è¿è¡Œæ—¶é—´æ£€æŸ¥ï¼š"
UPTIME=$(curl -s http://localhost:8000/health | grep -o '"uptime":[^,}]*' | cut -d':' -f2)
echo "   â±ï¸ è¿è¡Œæ—¶é—´: ${UPTIME} ç§’"

echo "=================================="
echo "ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼åº”ç”¨ç¨‹åºè¿è¡Œæ­£å¸¸ã€‚"

# æ˜¾ç¤ºè®¿é—®ä¿¡æ¯
PUBLIC_IP=$(curl -s http://169.254.169.254/latest/meta-data/public-ipv4)
echo ""
echo "ğŸŒ è®¿é—®åœ°å€ï¼š"
echo "   æœ¬åœ°: http://localhost:8000/"
echo "   å¤–ç½‘: http://${PUBLIC_IP}:8000/"
echo "   å¥åº·æ£€æŸ¥: http://${PUBLIC_IP}:8000/health"

EOF

# è®¾ç½®æ‰§è¡Œæƒé™
chmod +x /home/ubuntu/check_app.sh

# è¿è¡Œæ£€æŸ¥
/home/ubuntu/check_app.sh
```

---

## ğŸ¯ æ£€æŸ¥ç»“æœåˆ¤æ–­

### âœ… åº”ç”¨ç¨‹åºæ­£å¸¸çš„æ ‡å¿—ï¼š
- systemctl status æ˜¾ç¤º `active (running)`
- ç«¯å£ 8000 æ­£åœ¨ç›‘å¬
- HTTP è¯·æ±‚è¿”å›çŠ¶æ€ç  200
- å¥åº·æ£€æŸ¥è¿”å› `"status": "healthy"`
- æ—¥å¿—ä¸­æ²¡æœ‰é”™è¯¯ä¿¡æ¯
- å†…å­˜ä½¿ç”¨åˆç†ï¼ˆ< 100MBï¼‰

### âŒ éœ€è¦æ³¨æ„çš„å¼‚å¸¸ï¼š
- æœåŠ¡çŠ¶æ€ä¸º `failed` æˆ– `inactive`
- ç«¯å£ 8000 æœªå¼€æ”¾
- HTTP è¯·æ±‚è¶…æ—¶æˆ–è¿”å›é”™è¯¯çŠ¶æ€ç 
- å¥åº·æ£€æŸ¥å¤±è´¥
- æ—¥å¿—ä¸­å‡ºç° ERROR æˆ– Exception
- å†…å­˜ä½¿ç”¨è¿‡é«˜

### ğŸ“ è·å–å¸®åŠ©ï¼š
å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š
1. æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼š`sudo journalctl -u my-python-app -n 50`
2. å‚è€ƒ [ä½¿ç”¨è¯´æ˜_ä¸­æ–‡ç‰ˆ.md](./ä½¿ç”¨è¯´æ˜_ä¸­æ–‡ç‰ˆ.md) çš„æ•…éšœæ’é™¤éƒ¨åˆ†
3. è¿è¡Œè‡ªåŠ¨æ£€æŸ¥è„šæœ¬è·å–è¯¦ç»†è¯Šæ–­ä¿¡æ¯

---

**è®°ä½ï¼šéƒ¨ç½²æˆåŠŸåï¼Œåº”ç”¨ç¨‹åºåº”è¯¥èƒ½å¤Ÿåœ¨å‡ åˆ†é’Ÿå†…æ­£å¸¸å“åº”ã€‚å¦‚æœè¶…è¿‡ 10 åˆ†é’Ÿä»æœ‰é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥éƒ¨ç½²æ—¥å¿—å’Œé…ç½®ã€‚**